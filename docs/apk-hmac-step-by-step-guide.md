# Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ú©Ø§Ù…Ù„ APK HMAC Protection - Ù…Ø±Ø­Ù„Ù‡ Ø¨Ù‡ Ù…Ø±Ø­Ù„Ù‡

## ğŸ“‹ ÙÙ‡Ø±Ø³Øª Ù…Ø·Ø§Ù„Ø¨
1. [Ù…Ù‚Ø¯Ù…Ù‡ Ùˆ Ù‡Ø¯Ù](#Ù…Ù‚Ø¯Ù…Ù‡-Ùˆ-Ù‡Ø¯Ù)
2. [Ù…Ø±Ø­Ù„Ù‡ 1: Ø¢Ù…Ø§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Ù¾Ø±ÙˆÚ˜Ù‡](#Ù…Ø±Ø­Ù„Ù‡-1-Ø¢Ù…Ø§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ-Ù¾Ø±ÙˆÚ˜Ù‡)
3. [Ù…Ø±Ø­Ù„Ù‡ 2: Ù†ØµØ¨ Ùˆ Ù¾ÛŒÚ©Ø±Ø¨Ù†Ø¯ÛŒ](#Ù…Ø±Ø­Ù„Ù‡-2-Ù†ØµØ¨-Ùˆ-Ù¾ÛŒÚ©Ø±Ø¨Ù†Ø¯ÛŒ)
4. [Ù…Ø±Ø­Ù„Ù‡ 3: ØªÙˆÙ„ÛŒØ¯ APK](#Ù…Ø±Ø­Ù„Ù‡-3-ØªÙˆÙ„ÛŒØ¯-apk)
5. [Ù…Ø±Ø­Ù„Ù‡ 4: ØªÙˆÙ„ÛŒØ¯ HMAC Signature](#Ù…Ø±Ø­Ù„Ù‡-4-ØªÙˆÙ„ÛŒØ¯-hmac-signature)
6. [Ù…Ø±Ø­Ù„Ù‡ 5: Ø§Ø¯ØºØ§Ù… Ø¯Ø± Ø§Ù¾Ù„ÛŒÚ©ÛŒØ´Ù†](#Ù…Ø±Ø­Ù„Ù‡-5-Ø§Ø¯ØºØ§Ù…-Ø¯Ø±-Ø§Ù¾Ù„ÛŒÚ©ÛŒØ´Ù†)
7. [Ù…Ø±Ø­Ù„Ù‡ 6: ØªØ³Øª Ùˆ ØªØ£ÛŒÛŒØ¯](#Ù…Ø±Ø­Ù„Ù‡-6-ØªØ³Øª-Ùˆ-ØªØ£ÛŒÛŒØ¯)
8. [Ù…Ø±Ø­Ù„Ù‡ 7: Ø§Ø³ØªÙ‚Ø±Ø§Ø± Ø¯Ø± ØªÙˆÙ„ÛŒØ¯](#Ù…Ø±Ø­Ù„Ù‡-7-Ø§Ø³ØªÙ‚Ø±Ø§Ø±-Ø¯Ø±-ØªÙˆÙ„ÛŒØ¯)
9. [Ø¹ÛŒØ¨â€ŒÛŒØ§Ø¨ÛŒ Ùˆ Ù…Ø´Ú©Ù„Ø§Øª Ø±Ø§ÛŒØ¬](#Ø¹ÛŒØ¨â€ŒÛŒØ§Ø¨ÛŒ-Ùˆ-Ù…Ø´Ú©Ù„Ø§Øª-Ø±Ø§ÛŒØ¬)
10. [Ø¨Ù‡ØªØ±ÛŒÙ† Ø±ÙˆØ´â€ŒÙ‡Ø§](#Ø¨Ù‡ØªØ±ÛŒÙ†-Ø±ÙˆØ´â€ŒÙ‡Ø§)

---

## Ù…Ù‚Ø¯Ù…Ù‡ Ùˆ Ù‡Ø¯Ù

**APK HMAC Protection System** ÛŒÚ© Ø³ÛŒØ³ØªÙ… Ø§Ù…Ù†ÛŒØªÛŒ Ù¾ÛŒØ´Ø±ÙØªÙ‡ Ø§Ø³Øª Ú©Ù‡ Ø§Ø² Ø§Ù¾Ù„ÛŒÚ©ÛŒØ´Ù† Ø´Ù…Ø§ Ø¯Ø± Ø¨Ø±Ø§Ø¨Ø± **repackaging** Ùˆ **tampering** Ù…Ø­Ø§ÙØ¸Øª Ù…ÛŒâ€ŒÚ©Ù†Ø¯.

### ğŸ¯ Ø§Ù‡Ø¯Ø§Ù:
- Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² ØªØºÛŒÛŒØ± APK ØªÙˆØ³Ø· Ù…Ù‡Ø§Ø¬Ù…Ø§Ù†
- ØªØ´Ø®ÛŒØµ Ù†ØµØ¨ Ø§Ø² Ù…Ù†Ø§Ø¨Ø¹ ØºÛŒØ±Ù…Ø¬Ø§Ø²
- ØªØ£ÛŒÛŒØ¯ Ø§ØµØ§Ù„Øª Ø§Ù¾Ù„ÛŒÚ©ÛŒØ´Ù† Ø¯Ø± runtime
- Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ø³Ø®Øªâ€ŒØ§ÙØ²Ø§Ø± Ø§Ù…Ù†ÛŒØªÛŒ Ø¯Ø³ØªÚ¯Ø§Ù‡

---

## Ù…Ø±Ø­Ù„Ù‡ 1: Ø¢Ù…Ø§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Ù¾Ø±ÙˆÚ˜Ù‡

### 1.1 Ø¨Ø±Ø±Ø³ÛŒ Ù¾ÛŒØ´â€ŒÙ†ÛŒØ§Ø²Ù‡Ø§

```bash
# Ø¨Ø±Ø±Ø³ÛŒ Ù†Ø³Ø®Ù‡ Java
java -version
# Ø¨Ø§ÛŒØ¯ Java 8 ÛŒØ§ Ø¨Ø§Ù„Ø§ØªØ± Ø¨Ø§Ø´Ø¯

# Ø¨Ø±Ø±Ø³ÛŒ Ù†Ø³Ø®Ù‡ Python
python3 --version
# Ø¨Ø§ÛŒØ¯ Python 3.6 ÛŒØ§ Ø¨Ø§Ù„Ø§ØªØ± Ø¨Ø§Ø´Ø¯

# Ø¨Ø±Ø±Ø³ÛŒ Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§
ls -la scripts/
```

### 1.2 Ø³Ø§Ø®ØªØ§Ø± Ù¾Ø±ÙˆÚ˜Ù‡

```
your-project/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ src/main/
â”‚   â”‚   â”œâ”€â”€ assets/          # Ø§ÛŒÙ†Ø¬Ø§ signature Ø°Ø®ÛŒØ±Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯
â”‚   â”‚   â”œâ”€â”€ java/
â”‚   â”‚   â””â”€â”€ res/
â”‚   â””â”€â”€ build.gradle
â”œâ”€â”€ scripts/                 # Ø§Ø³Ú©Ø±ÛŒÙ¾Øªâ€ŒÙ‡Ø§ÛŒ HMAC
â””â”€â”€ docs/                   # Ù…Ø³ØªÙ†Ø¯Ø§Øª
```

### 1.3 Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† dependency

Ø¯Ø± ÙØ§ÛŒÙ„ `app/build.gradle`:

```gradle
dependencies {
    implementation 'com.miaadrajabi.securitymodule:securitymodule:1.0.0'
    // ÛŒØ§ Ø§Ú¯Ø± local module Ø§Ø³Øª:
    implementation project(':securitymodule')
}
```

---

## Ù…Ø±Ø­Ù„Ù‡ 2: Ù†ØµØ¨ Ùˆ Ù¾ÛŒÚ©Ø±Ø¨Ù†Ø¯ÛŒ

### 2.1 Ú©Ù¾ÛŒ Ú©Ø±Ø¯Ù† Ø§Ø³Ú©Ø±ÛŒÙ¾Øªâ€ŒÙ‡Ø§

```bash
# Ú©Ù¾ÛŒ Ø§Ø³Ú©Ø±ÛŒÙ¾Øªâ€ŒÙ‡Ø§ Ø¨Ù‡ Ù¾Ø±ÙˆÚ˜Ù‡ Ø´Ù…Ø§
cp -r /path/to/PosSecurity/scripts/ ./scripts/
chmod +x scripts/*.sh
chmod +x scripts/*.py
```

### 2.2 ØªØ³Øª Ø§Ø³Ú©Ø±ÛŒÙ¾Øªâ€ŒÙ‡Ø§

```bash
# ØªØ³Øª Ø§Ø³Ú©Ø±ÛŒÙ¾Øª Python
python3 scripts/generate_apk_hmac.py --help

# ØªØ³Øª Ø§Ø³Ú©Ø±ÛŒÙ¾Øª Shell
./scripts/sign_apk_with_hmac.sh --help
```

### 2.3 Ù¾ÛŒÚ©Ø±Ø¨Ù†Ø¯ÛŒ Gradle

Ø¯Ø± ÙØ§ÛŒÙ„ `app/build.gradle`:

```gradle
android {
    // ... Ø³Ø§ÛŒØ± ØªÙ†Ø¸ÛŒÙ…Ø§Øª
    
    buildTypes {
        release {
            // ... Ø³Ø§ÛŒØ± ØªÙ†Ø¸ÛŒÙ…Ø§Øª
            
            // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† task Ø¨Ø±Ø§ÛŒ ØªÙˆÙ„ÛŒØ¯ HMAC
            doLast {
                exec {
                    commandLine 'bash', '../scripts/sign_apk_with_hmac.sh', 
                        "${buildDir}/outputs/apk/release/app-release.apk",
                        '-a', 'src/main/assets/',
                        '-v'
                }
            }
        }
    }
}
```

---

## Ù…Ø±Ø­Ù„Ù‡ 3: ØªÙˆÙ„ÛŒØ¯ APK

### 3.1 Build Ú©Ø±Ø¯Ù† Ù¾Ø±ÙˆÚ˜Ù‡

```bash
# Clean Ú©Ø±Ø¯Ù† Ù¾Ø±ÙˆÚ˜Ù‡
./gradlew clean

# Build Ú©Ø±Ø¯Ù† APK
./gradlew assembleRelease

# ÛŒØ§ Ø¨Ø±Ø§ÛŒ debug
./gradlew assembleDebug
```

### 3.2 Ø¨Ø±Ø±Ø³ÛŒ APK ØªÙˆÙ„ÛŒØ¯ Ø´Ø¯Ù‡

```bash
# Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¬ÙˆØ¯ APK
ls -la app/build/outputs/apk/release/

# Ø¨Ø±Ø±Ø³ÛŒ Ø§Ù†Ø¯Ø§Ø²Ù‡ APK
du -h app/build/outputs/apk/release/app-release.apk
```

### 3.3 Ù…Ø³ÛŒØ± APK

APK Ø´Ù…Ø§ Ø¯Ø± Ø§ÛŒÙ† Ù…Ø³ÛŒØ± Ù‚Ø±Ø§Ø± Ø¯Ø§Ø±Ø¯:
```
app/build/outputs/apk/release/app-release.apk
```

---

## Ù…Ø±Ø­Ù„Ù‡ 4: ØªÙˆÙ„ÛŒØ¯ HMAC Signature

### 4.1 Ø±ÙˆØ´ Ø¯Ø³ØªÛŒ

```bash
# ØªÙˆÙ„ÛŒØ¯ signature Ø¨Ø§ Ø§Ø³Ú©Ø±ÛŒÙ¾Øª Shell
./scripts/sign_apk_with_hmac.sh app/build/outputs/apk/release/app-release.apk

# ÛŒØ§ Ø¨Ø§ Python
python3 scripts/generate_apk_hmac.py app/build/outputs/apk/release/app-release.apk
```

### 4.2 Ø±ÙˆØ´ Ø®ÙˆØ¯Ú©Ø§Ø± (ØªÙˆØµÛŒÙ‡ Ø´Ø¯Ù‡)

```bash
# Ø§Ø¬Ø±Ø§ÛŒ build Ø¨Ø§ ØªÙˆÙ„ÛŒØ¯ Ø®ÙˆØ¯Ú©Ø§Ø± signature
./gradlew assembleRelease
```

### 4.3 Ø¨Ø±Ø±Ø³ÛŒ signature ØªÙˆÙ„ÛŒØ¯ Ø´Ø¯Ù‡

```bash
# Ø¨Ø±Ø±Ø³ÛŒ ÙØ§ÛŒÙ„ signature
ls -la app/src/main/assets/apk_hmac_signature.txt

# Ù…Ø­ØªÙˆØ§ÛŒ signature
cat app/src/main/assets/apk_hmac_signature.txt
```

### 4.4 Ø®Ø±ÙˆØ¬ÛŒ Ù…ÙˆØ±Ø¯ Ø§Ù†ØªØ¸Ø§Ø±

```
âœ… APK HMAC signing completed successfully!
ğŸ“ Output file: app-release_hmac_signature.txt
ğŸ“Š APK hash: a1b2c3d4e5f6...
ğŸ” HMAC signature: 680ddcb08678f2932bf01672f9671ec0bdba1a6bdb161e989235c9981c3289c9
```

---

## Ù…Ø±Ø­Ù„Ù‡ 5: Ø§Ø¯ØºØ§Ù… Ø¯Ø± Ø§Ù¾Ù„ÛŒÚ©ÛŒØ´Ù†

### 5.1 Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† import

Ø¯Ø± ÙØ§ÛŒÙ„ `MainActivity.kt` ÛŒØ§ Ú©Ù„Ø§Ø³ Ø§ØµÙ„ÛŒ:

```kotlin
import com.miaadrajabi.securitymodule.crypto.ApkHmacProtector
import kotlinx.coroutines.*
```

### 5.2 Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ú©Ø¯ ØªØ£ÛŒÛŒØ¯ Ø¯Ø± onCreate

```kotlin
class MainActivity : AppCompatActivity() {
    
    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        setContentView(R.layout.activity_main)
        
        // ØªØ£ÛŒÛŒØ¯ APK integrity Ø¯Ø± startup
        verifyApkIntegrity()
    }
    
    private fun verifyApkIntegrity() {
        lifecycleScope.launch {
            try {
                // ØªØ£ÛŒÛŒØ¯ integrity
                val integrityInfo = ApkHmacProtector.verifyApkIntegrity(this@MainActivity)
                
                if (!integrityInfo.isIntegrityValid) {
                    // APK ØªØºÛŒÛŒØ± Ú©Ø±Ø¯Ù‡ - Ø§Ù‚Ø¯Ø§Ù… Ø§Ù…Ù†ÛŒØªÛŒ
                    handleSecurityBreach()
                    return@launch
                }
                
                // Ø¨Ø±Ø±Ø³ÛŒ repackaging
                val isRepackaged = ApkHmacProtector.detectRepackaging(this@MainActivity)
                
                if (isRepackaged) {
                    // APK repackaged Ø´Ø¯Ù‡ - Ø§Ù‚Ø¯Ø§Ù… Ø§Ù…Ù†ÛŒØªÛŒ
                    handleRepackagingDetected()
                    return@launch
                }
                
                // Ù‡Ù…Ù‡ Ú†ÛŒØ² OK
                Log.d("APK", "APK integrity verified successfully")
                
            } catch (e: Exception) {
                Log.e("APK", "APK integrity check failed", e)
                // Ø¯Ø± ØµÙˆØ±Øª Ø®Ø·Ø§ØŒ Ø§Ù‚Ø¯Ø§Ù… Ø§Ù…Ù†ÛŒØªÛŒ
                handleSecurityError()
            }
        }
    }
    
    private fun handleSecurityBreach() {
        // Ø§Ù‚Ø¯Ø§Ù…Ø§Øª Ø§Ù…Ù†ÛŒØªÛŒ Ø¯Ø± ØµÙˆØ±Øª ØªØºÛŒÛŒØ± APK
        Toast.makeText(this, "Security breach detected!", Toast.LENGTH_LONG).show()
        // Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø§Ù¾Ù„ÛŒÚ©ÛŒØ´Ù† Ø±Ø§ Ø¨Ø¨Ù†Ø¯ÛŒØ¯ ÛŒØ§ Ø¨Ù‡ ØµÙØ­Ù‡ Ø§Ù…Ù†ÛŒØªÛŒ Ø¨Ø±ÙˆÛŒØ¯
        finish()
    }
    
    private fun handleRepackagingDetected() {
        // Ø§Ù‚Ø¯Ø§Ù…Ø§Øª Ø§Ù…Ù†ÛŒØªÛŒ Ø¯Ø± ØµÙˆØ±Øª repackaging
        Toast.makeText(this, "Repackaging detected!", Toast.LENGTH_LONG).show()
        finish()
    }
    
    private fun handleSecurityError() {
        // Ø§Ù‚Ø¯Ø§Ù…Ø§Øª Ø§Ù…Ù†ÛŒØªÛŒ Ø¯Ø± ØµÙˆØ±Øª Ø®Ø·Ø§
        Toast.makeText(this, "Security check failed!", Toast.LENGTH_LONG).show()
        finish()
    }
}
```

### 5.3 Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¨Ø±Ø±Ø³ÛŒ Ø¯ÙˆØ±Ù‡â€ŒØ§ÛŒ

```kotlin
class MainActivity : AppCompatActivity() {
    
    private val securityCheckInterval = 30000L // 30 Ø«Ø§Ù†ÛŒÙ‡
    
    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        setContentView(R.layout.activity_main)
        
        // ØªØ£ÛŒÛŒØ¯ Ø§ÙˆÙ„ÛŒÙ‡
        verifyApkIntegrity()
        
        // Ø¨Ø±Ø±Ø³ÛŒ Ø¯ÙˆØ±Ù‡â€ŒØ§ÛŒ
        startPeriodicSecurityCheck()
    }
    
    private fun startPeriodicSecurityCheck() {
        lifecycleScope.launch {
            while (isActive) {
                delay(securityCheckInterval)
                
                try {
                    val isRepackaged = ApkHmacProtector.detectRepackaging(this@MainActivity)
                    if (isRepackaged) {
                        handleRepackagingDetected()
                        break
                    }
                } catch (e: Exception) {
                    Log.e("APK", "Periodic security check failed", e)
                }
            }
        }
    }
}
```

---

## Ù…Ø±Ø­Ù„Ù‡ 6: ØªØ³Øª Ùˆ ØªØ£ÛŒÛŒØ¯

### 6.1 ØªØ³Øª Ø§ÙˆÙ„ÛŒÙ‡

```bash
# Build Ùˆ Ù†ØµØ¨ Ø§Ù¾Ù„ÛŒÚ©ÛŒØ´Ù†
./gradlew installRelease

# ÛŒØ§ Ø¨Ø±Ø§ÛŒ debug
./gradlew installDebug
```

### 6.2 ØªØ³Øª Ø¹Ù…Ù„Ú©Ø±Ø¯

1. **ØªØ³Øª Ù…ÙˆÙÙ‚ÛŒØªâ€ŒØ¢Ù…ÛŒØ²:**
   - Ø§Ù¾Ù„ÛŒÚ©ÛŒØ´Ù† Ø¨Ø§ÛŒØ¯ Ø¨Ø¯ÙˆÙ† Ù…Ø´Ú©Ù„ Ø§Ø¬Ø±Ø§ Ø´ÙˆØ¯
   - Ù„Ø§Ú¯â€ŒÙ‡Ø§ Ø¨Ø§ÛŒØ¯ "APK integrity verified successfully" Ø±Ø§ Ù†Ø´Ø§Ù† Ø¯Ù‡Ù†Ø¯

2. **ØªØ³Øª ØªØºÛŒÛŒØ± APK:**
   - APK Ø±Ø§ ØªØºÛŒÛŒØ± Ø¯Ù‡ÛŒØ¯ (Ù…Ø«Ù„Ø§Ù‹ Ø¨Ø§ apktool)
   - Ø§Ù¾Ù„ÛŒÚ©ÛŒØ´Ù† Ø¨Ø§ÛŒØ¯ Ø®Ø·Ø§ÛŒ Ø§Ù…Ù†ÛŒØªÛŒ Ù†Ø´Ø§Ù† Ø¯Ù‡Ø¯

### 6.3 ØªØ³Øª Ø¨Ø§ Ø¯Ú©Ù…Ù‡ APK HMAC Protection

Ø¯Ø± Ø§Ù¾Ù„ÛŒÚ©ÛŒØ´Ù† Ù†Ù…ÙˆÙ†Ù‡:
1. Ø¯Ú©Ù…Ù‡ "ğŸ›¡ï¸ APK HMAC Protection" Ø±Ø§ ÙØ´Ø§Ø± Ø¯Ù‡ÛŒØ¯
2. Ù†ØªØ§ÛŒØ¬ Ø±Ø§ Ø¯Ø± TestResultsActivity Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒØ¯

### 6.4 Ø¨Ø±Ø±Ø³ÛŒ Ù„Ø§Ú¯â€ŒÙ‡Ø§

```bash
# Ø¨Ø±Ø±Ø³ÛŒ Ù„Ø§Ú¯â€ŒÙ‡Ø§ÛŒ Ø§Ù¾Ù„ÛŒÚ©ÛŒØ´Ù†
adb logcat | grep "ApkHmacProtector"

# ÛŒØ§
adb logcat | grep "APK"
```

---

## Ù…Ø±Ø­Ù„Ù‡ 7: Ø§Ø³ØªÙ‚Ø±Ø§Ø± Ø¯Ø± ØªÙˆÙ„ÛŒØ¯

### 7.1 Build Ù†Ù‡Ø§ÛŒÛŒ

```bash
# Clean Ùˆ build Ú©Ø§Ù…Ù„
./gradlew clean
./gradlew assembleRelease

# Ø¨Ø±Ø±Ø³ÛŒ APK Ù†Ù‡Ø§ÛŒÛŒ
ls -la app/build/outputs/apk/release/
```

### 7.2 ØªØ£ÛŒÛŒØ¯ signature

```bash
# Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¬ÙˆØ¯ signature
cat app/src/main/assets/apk_hmac_signature.txt

# Ø¨Ø±Ø±Ø³ÛŒ Ù…Ø­ØªÙˆØ§ÛŒ APK
unzip -l app/build/outputs/apk/release/app-release.apk | grep signature
```

### 7.3 ØªØ³Øª Ù†Ù‡Ø§ÛŒÛŒ

```bash
# Ù†ØµØ¨ Ùˆ ØªØ³Øª
adb install -r app/build/outputs/apk/release/app-release.apk

# Ø§Ø¬Ø±Ø§ÛŒ Ø§Ù¾Ù„ÛŒÚ©ÛŒØ´Ù† Ùˆ Ø¨Ø±Ø±Ø³ÛŒ Ø¹Ù…Ù„Ú©Ø±Ø¯
adb shell am start -n com.yourpackage/.MainActivity
```

### 7.4 Ø§Ù†ØªØ´Ø§Ø±

```bash
# Ø¢Ù¾Ù„ÙˆØ¯ Ø¨Ù‡ Google Play Store ÛŒØ§ Ø³Ø§ÛŒØ± Ù¾Ù„ØªÙØ±Ù…â€ŒÙ‡Ø§
# APK Ø¨Ø§ signature Ù…Ø­Ø§ÙØ¸Øª Ø´Ø¯Ù‡ Ø¢Ù…Ø§Ø¯Ù‡ Ø§Ø³Øª
```

---

## Ø¹ÛŒØ¨â€ŒÛŒØ§Ø¨ÛŒ Ùˆ Ù…Ø´Ú©Ù„Ø§Øª Ø±Ø§ÛŒØ¬

### Ù…Ø´Ú©Ù„ 1: Ø§Ø³Ú©Ø±ÛŒÙ¾Øª Ø§Ø¬Ø±Ø§ Ù†Ù…ÛŒâ€ŒØ´ÙˆØ¯

```bash
# Ø¨Ø±Ø±Ø³ÛŒ Ø¯Ø³ØªØ±Ø³ÛŒ
ls -la scripts/sign_apk_with_hmac.sh

# ØªØºÛŒÛŒØ± Ø¯Ø³ØªØ±Ø³ÛŒ
chmod +x scripts/sign_apk_with_hmac.sh

# ØªØ³Øª Ø§Ø¬Ø±Ø§
./scripts/sign_apk_with_hmac.sh --help
```

### Ù…Ø´Ú©Ù„ 2: Python script Ø®Ø·Ø§ Ù…ÛŒâ€ŒØ¯Ù‡Ø¯

```bash
# Ø¨Ø±Ø±Ø³ÛŒ Ù†Ø³Ø®Ù‡ Python
python3 --version

# Ù†ØµØ¨ dependencies
pip3 install hashlib hmac

# ØªØ³Øª script
python3 scripts/generate_apk_hmac.py --help
```

### Ù…Ø´Ú©Ù„ 3: Signature ØªÙˆÙ„ÛŒØ¯ Ù†Ù…ÛŒâ€ŒØ´ÙˆØ¯

```bash
# Ø¨Ø±Ø±Ø³ÛŒ Ù…Ø³ÛŒØ± APK
ls -la app/build/outputs/apk/release/app-release.apk

# Ø¨Ø±Ø±Ø³ÛŒ Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ ÙØ§ÛŒÙ„
file app/build/outputs/apk/release/app-release.apk

# Ø§Ø¬Ø±Ø§ÛŒ Ø¯Ø³ØªÛŒ
./scripts/sign_apk_with_hmac.sh app/build/outputs/apk/release/app-release.apk -v
```

### Ù…Ø´Ú©Ù„ 4: Ø§Ù¾Ù„ÛŒÚ©ÛŒØ´Ù† crash Ù…ÛŒâ€ŒÚ©Ù†Ø¯

```kotlin
// Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† try-catch
try {
    val integrityInfo = ApkHmacProtector.verifyApkIntegrity(context)
    // ...
} catch (e: Exception) {
    Log.e("APK", "Integrity check failed", e)
    // Ø§Ù‚Ø¯Ø§Ù… Ù…Ù†Ø§Ø³Ø¨
}
```

### Ù…Ø´Ú©Ù„ 5: Signature Ù¾ÛŒØ¯Ø§ Ù†Ù…ÛŒâ€ŒØ´ÙˆØ¯

```kotlin
// Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¬ÙˆØ¯ ÙØ§ÛŒÙ„ signature
val signatureFile = File("${context.filesDir}/apk_hmac_signature.txt")
if (!signatureFile.exists()) {
    Log.e("APK", "Signature file not found")
    // ØªÙˆÙ„ÛŒØ¯ signature ÛŒØ§ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² fallback
}
```

---

## Ø¨Ù‡ØªØ±ÛŒÙ† Ø±ÙˆØ´â€ŒÙ‡Ø§

### 1. Ø§Ù…Ù†ÛŒØª

```kotlin
// Ù‡Ù…ÛŒØ´Ù‡ Ø¯Ø± background thread Ø§Ø¬Ø±Ø§ Ú©Ù†ÛŒØ¯
lifecycleScope.launch(Dispatchers.IO) {
    val integrityInfo = ApkHmacProtector.verifyApkIntegrity(context)
    // ...
}

// Ø§Ø² hardware-backed keys Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯
val key = SecureHmacHelper.getBestAvailableHmacKey()
```

### 2. Ø¹Ù…Ù„Ú©Ø±Ø¯

```kotlin
// Ø¨Ø±Ø±Ø³ÛŒ Ø¯ÙˆØ±Ù‡â€ŒØ§ÛŒ Ø±Ø§ Ø¨Ù‡ÛŒÙ†Ù‡ Ú©Ù†ÛŒØ¯
private val securityCheckInterval = 60000L // 1 Ø¯Ù‚ÛŒÙ‚Ù‡

// Ø§Ø² cache Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯
private var lastIntegrityCheck = 0L
private val integrityCheckInterval = 300000L // 5 Ø¯Ù‚ÛŒÙ‚Ù‡
```

### 3. Ù…Ø¯ÛŒØ±ÛŒØª Ø®Ø·Ø§

```kotlin
// Ù…Ø¯ÛŒØ±ÛŒØª graceful Ø¨Ø±Ø§ÛŒ Ø®Ø·Ø§Ù‡Ø§
private fun handleSecurityError() {
    // Ù„Ø§Ú¯ Ú©Ø±Ø¯Ù†
    Log.e("APK", "Security check failed")
    
    // Ø§Ø·Ù„Ø§Ø¹â€ŒØ±Ø³Ø§Ù†ÛŒ Ø¨Ù‡ Ú©Ø§Ø±Ø¨Ø±
    showSecurityWarning()
    
    // Ø§Ù‚Ø¯Ø§Ù… Ø§Ù…Ù†ÛŒØªÛŒ
    // finish() ÛŒØ§ redirect Ø¨Ù‡ ØµÙØ­Ù‡ Ø§Ù…Ù†ÛŒØªÛŒ
}
```

### 4. ØªØ³Øª

```kotlin
// ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ ÙˆØ§Ø­Ø¯
@Test
fun testApkIntegrity() {
    val integrityInfo = ApkHmacProtector.verifyApkIntegrity(context)
    assertTrue(integrityInfo.isIntegrityValid)
}

// ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ integration
@Test
fun testRepackagingDetection() {
    val isRepackaged = ApkHmacProtector.detectRepackaging(context)
    assertFalse(isRepackaged)
}
```

### 5. CI/CD

```yaml
# GitHub Actions
- name: Build APK
  run: ./gradlew assembleRelease

- name: Generate HMAC Signature
  run: ./scripts/sign_apk_with_hmac.sh app/build/outputs/apk/release/app-release.apk

- name: Test APK
  run: ./gradlew test
```

---

## Ø®Ù„Ø§ØµÙ‡ Ù…Ø±Ø§Ø­Ù„

1. âœ… **Ø¢Ù…Ø§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ**: Ù†ØµØ¨ dependencies Ùˆ Ø§Ø³Ú©Ø±ÛŒÙ¾Øªâ€ŒÙ‡Ø§
2. âœ… **Ù¾ÛŒÚ©Ø±Ø¨Ù†Ø¯ÛŒ**: ØªÙ†Ø¸ÛŒÙ… Gradle Ùˆ Ù…Ø³ÛŒØ±Ù‡Ø§
3. âœ… **ØªÙˆÙ„ÛŒØ¯ APK**: build Ú©Ø±Ø¯Ù† Ù¾Ø±ÙˆÚ˜Ù‡
4. âœ… **ØªÙˆÙ„ÛŒØ¯ Signature**: Ø§Ø¬Ø±Ø§ÛŒ Ø§Ø³Ú©Ø±ÛŒÙ¾Øª HMAC
5. âœ… **Ø§Ø¯ØºØ§Ù…**: Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ú©Ø¯ ØªØ£ÛŒÛŒØ¯
6. âœ… **ØªØ³Øª**: Ø¨Ø±Ø±Ø³ÛŒ Ø¹Ù…Ù„Ú©Ø±Ø¯
7. âœ… **Ø§Ø³ØªÙ‚Ø±Ø§Ø±**: Ø§Ù†ØªØ´Ø§Ø± Ù†Ù‡Ø§ÛŒÛŒ

---

## Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ

Ø¯Ø± ØµÙˆØ±Øª Ø¨Ø±ÙˆØ² Ù…Ø´Ú©Ù„:
1. Ù„Ø§Ú¯â€ŒÙ‡Ø§ Ø±Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒØ¯
2. Ù…Ø³ØªÙ†Ø¯Ø§Øª Ø±Ø§ Ù…Ø·Ø§Ù„Ø¹Ù‡ Ú©Ù†ÛŒØ¯
3. ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ù†Ù…ÙˆÙ†Ù‡ Ø±Ø§ Ø§Ø¬Ø±Ø§ Ú©Ù†ÛŒØ¯
4. Ø¨Ø§ ØªÛŒÙ… ØªÙˆØ³Ø¹Ù‡ ØªÙ…Ø§Ø³ Ø¨Ú¯ÛŒØ±ÛŒØ¯

**ğŸ‰ Ø­Ø§Ù„Ø§ APK Ø´Ù…Ø§ Ø¨Ø§ HMAC Ù…Ø­Ø§ÙØ¸Øª Ø´Ø¯Ù‡ Ùˆ Ø¯Ø± Ø¨Ø±Ø§Ø¨Ø± repackaging Ø§Ù…Ù† Ø§Ø³Øª!**
